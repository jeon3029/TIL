<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>트랜잭션 :: jeon3029 wiki</title>
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">jeon3029 wiki</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://github.com/jeon3029">Github</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../first/">Dev Learning Archive</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Writings</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../asciidoc/description/">Asciidoc.. 어떤가?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../chat-gpt/">Chap-GPT</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web-hacking/">Webhacking 을 통한 Web 에 대한 이해</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../web-socket/">웹소켓 101</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Asciidoc Sample</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../asciidoc/sample/inline-text-formatting/">Inline Text Formatting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../asciidoc/sample/special-characters/">Special Characters and Symbols</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../asciidoc/sample/admonition/">Admonition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../asciidoc/sample/sidebar/">Sidebar</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../asciidoc/sample/ui-macros/">User Interface Macros</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lists</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../asciidoc/sample/lists/ordered-list/">Ordered Lists</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../asciidoc/sample/lists/unordered-list/">Unordered Lists</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">test</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../testt/test/">스터디 재미있다.</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Dev Learning Archive</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../../first/">Dev Learning Archive</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../first/">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../first/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../first/">Dev Learning Archive</a></li>
    <li><a href="./">트랜잭션</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">트랜잭션</h1>
<div id="preamble">
<div class="sectionbody">
<div class="ulist">
<div class="title">트랜잭션이란?</div>
<ul>
<li>
<p>어플리케이션에서 몇개의 읽기와 쓰기를 하나의 논리적 단위로 묶는 방법</p>
</li>
<li>
<p>전체가 성공(커밋) 하거나, 실패(어보트) 한다</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">트랜잭션이 제공하는 안정성</div>
<ul>
<li>
<p>ACID(원자성/일관선/격리성/지속성)</p>
</li>
<li>
<p>원자성</p>
<div class="ulist">
<ul>
<li>
<p>더이상 쪼개지지 않는 것</p>
</li>
<li>
<p>실행되거나 실행되지 않는 상태만 있고 중간 상태는 없음</p>
</li>
</ul>
</div>
</li>
<li>
<p>일관성</p>
<div class="ulist">
<ul>
<li>
<p>트랜잭션이 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 유지하는 것</p>
</li>
<li>
<p>ex)회계시스템의 대변과 차변이 맞는 것</p>
</li>
<li>
<p>일관성은 실제로는 ACID에 속하지 않고 애플리케이션의 속성으로 본다</p>
</li>
</ul>
</div>
</li>
<li>
<p>격리성</p>
<div class="ulist">
<ul>
<li>
<p>동시에 실행되는 트랜잭션은 서로 격리되어 방해할 수 없다.</p>
</li>
<li>
<p>직렬성 격리는 성능 손해를 동반하므로 잘 쓰이지 않음</p>
</li>
</ul>
</div>
</li>
<li>
<p>지속성</p>
<div class="ulist">
<ul>
<li>
<p>성공적으로 커밋됐다면 하드웨어 결함이 발생하거나 데이터베이스가 죽더라도 트랜잭션에서 기록한 모든 데이터는 손실되지 않는다는 보장</p>
</li>
<li>
<p>지속성을 보장하려면 커밋 전에 복제가 완료되기 까지 기다려야 함.</p>
</li>
<li>
<p>완벽한 지속성은 존재하지 않음</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_완화된_격리_수준"><a class="anchor" href="#_완화된_격리_수준"></a>(완화된) 격리 수준</h2>
<div class="sectionbody">
<div class="paragraph">
<p>트랜잭션 끼리 동시에 같은 데이터를 변경하려고 한다면?
&#8594; 이론상은 트랜잭션끼리 격리되어있기 때문에 영향을 주지 않음
&#8594; 하지만 직렬성 격리는 비용이 큼. 따라서 완화된 격리 수준을 사용
** 일부 동시성 이슈는 해결해 주지만 일부는 해결하지 못함</p>
</div>
<div class="sect2">
<h3 id="_커밋_후_읽기read_committed"><a class="anchor" href="#_커밋_후_읽기read_committed"></a>커밋 후 읽기(READ COMMITTED)</h3>
<div class="paragraph">
<p>가장 기본적인 트랜잭션 격리
데이터베이스에서 읽을 때 커밋된 데이터만 보게 된다(더티 읽기가 없음)
데이터베이스에 쓸 때 커밋된 데이터만 덮어쓰게 된다(더티 쓰기가 없음)</p>
</div>
<div class="ulist">
<div class="title">더티 읽기</div>
<ul>
<li>
<p>더티 읽기가 생기면 다른 트랜잭션이 일부는 갱신된 값을, 일부는 갱신되지 않은 값을 볼 수 있다.</p>
</li>
</ul>
</div>
<div class="imageblock unresolved">
<div class="content">
<img src="img/dirty.png" alt="dirty">
</div>
</div>
<div class="paragraph">
<p>방지하는 법
* 과거의 커밋된 값/ 현재 쓰고 있는 새로운 값을 모두 기억</p>
</div>
<div class="ulist">
<div class="title">더티 쓰기</div>
<ul>
<li>
<p>나중에 실행된 쓰기 작업이 커밋되지 않은 값을 덮는 경우</p>
</li>
<li>
<p>더티 쓰기가 있으면 내용이 섞일 수 있다</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>방지하는 법
* 커밋되거나 어보트될 때까지 잠금을 보유
.스냅숏 격리방식
image::img/snapshot.png[]</p>
</div>
<div class="paragraph">
<p>읽는쪽에서는 쓰는 쪽을 막지 않으며, 쓰는 쪽에서는 읽는 쪽을 막지 않는다.</p>
</div>
</div>
<div class="sect2">
<h3 id="_갱신_손실_방지"><a class="anchor" href="#_갱신_손실_방지"></a>갱신 손실 방지</h3>
<div class="paragraph">
<p>갱신 손실 : 경쟁 조건에서 한쪽의 갱신이 다른 한쪽의 갱신을 덮어씌워버리는 것</p>
</div>
<div class="imageblock unresolved">
<div class="content">
<img src="img/update.png" alt="update">
</div>
</div>
<div class="paragraph">
<p>방지하는 법
* 원자적 쓰기 연산</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">UPDATE conters SETR value = value + 1 WHERE key = 'foo';// Db 에서 원자성이 보장되도록 제공 함</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>명시적인 잠금</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">begin transaction

select  * from figures
where name = 'robot' and game_id = 222
for update;
//모든 로우에 대해 잠금획득

update figures set position = 'c4' where id = 4

commit;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_직렬성"><a class="anchor" href="#_직렬성"></a>직렬성</h3>
<div class="ulist">
<ul>
<li>
<p>격리 수준은 이해하기 어렵고 데이터베이스마다 그 구현에 일관성이 없음</p>
</li>
<li>
<p>대안은 직렬성 격리 사용</p>
</li>
<li>
<p>직렬성 격리는 보통 가장 강력한 경리 수준이라고 여겨짐</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_직렬성을_제공하는_방법"><a class="anchor" href="#_직렬성을_제공하는_방법"></a>직렬성을 제공하는 방법</h4>
<div class="ulist">
<ul>
<li>
<p>직렬 실행</p>
<div class="ulist">
<ul>
<li>
<p>한 번에 트랜잭션 하나씩만 직렬로 단일 스레드에서 실행하면 됨</p>
</li>
<li>
<p>제약사항</p>
<div class="ulist">
<ul>
<li>
<p>모든 트랜잭션은 작고 빨라야 한다</p>
</li>
<li>
<p>활성화된 데이터셋이 메모리에 적재될 수 있는 경우로 사용이 제한</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>2단계 잠금</p>
<div class="ulist">
<ul>
<li>
<p>트랜잭션 A가 객체 하나를 읽고 트랜잭션 B가 그 객체에 쓰기를 원한다면 B는 진행하기 전에 A가 커밋되거나 어보트될 때까지 기다려야 한다</p>
</li>
<li>
<p>트랜잭션 A가 객체에 썼고 트랜잭션 B가 그 객체를 읽기 원한다면 B는 진행하기 전에 A가 커밋되거나 어보트될 때까지 기다려야 한다
&#8594; 읽는쪽에서도 쓰는 쪽을 막고, 쓰는쪽에서 읽는쪽을 막는다.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">단점</div>
<ul>
<li>
<p>잠금이 아주 많이 사용되므로 교착 상태(두 개의 트랜잭션이 서로 기다리는 것)가 매우 쉽게 발생할 수 있음</p>
</li>
<li>
<p>잠금을 획득하고 해제하는 오버헤드가 큼</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_직렬성_스냅숏_격리"><a class="anchor" href="#_직렬성_스냅숏_격리"></a>직렬성 스냅숏 격리</h2>
<div class="sectionbody">
<div class="paragraph">
<p>완화된 격리수준을 사용하면 성능은 좋지만, 다양한 경쟁조건(갱신손실, 더티리드 등)에 취약하다</p>
</div>
<div class="paragraph">
<p>직렬성 격리를 사용하면 성능이 좋지않다.</p>
</div>
<div class="paragraph">
<p>두가지를 모두 취할 수 는 없을까?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>직렬성을 제공하지만, 스냅숏 격리에 비해 조금의 성능 손해만 있을 뿐</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 1. 비관적 동시성 제어 vs 낙관적 동시성 제어</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>2단계 잠금은 비관적 동시성 제어 메커니즘임</p>
<div class="ulist">
<ul>
<li>
<p>뭔가 잘못될 가능성이 있으면 뭔가를 하기 전에 상황이 다시 안전해질 때 까지 기다리는게 낫다는 원칙</p>
</li>
</ul>
</div>
</li>
<li>
<p>직렬성 스냅숏 격리는 낙관적 동시성 제어 메커니즘</p>
<div class="ulist">
<ul>
<li>
<p>트랜잭션을 막는 대신 모든 것이 괜찮아질 거라는 희망을 갖고 계속 진행한다는 뜻</p>
</li>
<li>
<p>커밋되기를 원할 때 데이터베이스는 나쁜 상황이 발생했는지 확인함</p>
</li>
<li>
<p>경쟁이 심하면 abort 비율이 높아지므로 성능 떨어짐</p>
</li>
<li>
<p>트랜잭션 사이의 경쟁이 너무 심하지 않으면, 낙관적 동시성 제어 기법이 성능이 좋음</p>
</li>
<li>
<p>어보트 비율이 전체적인 성능에 큰 영향을 끼침</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
  </body>
</html>
